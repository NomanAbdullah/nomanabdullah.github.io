<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CSRF - Synchronizer Token Pattern - Noman Abdullah</title><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/"><link rel="amphtml" href="https://nomanabdullah.github.io/amp/csrf-synchnorizer-token-pattern/"><link type="application/atom+xml" rel="alternate" href="https://nomanabdullah.github.io/feed.xml"><meta property="og:title" content="CSRF - Synchronizer Token Pattern"><meta property="og:image" content="https://nomanabdullah.github.io/media/posts/6/final1.jpg"><meta property="og:site_name" content="Noman Abdullah | Blog"><meta property="og:description" content="Hello Visitors, Cross-Site Request Forgery (CSRF) is an attack that forces an end user to execute unwanted actions on a web application in which they’re currently authenticated. CSRF attacks specifically target state-changing requests, not theft of data since the attacker has no way to see&hellip;"><meta property="og:url" content="https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,700%7CRoboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet"><link rel="stylesheet" href="https://nomanabdullah.github.io/assets/css/style.css?v=aa41620c4f80dc7a8874270e3bdddd5b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/"},"headline":"CSRF - Synchronizer Token Pattern","datePublished":"2019-05-17T13:54","dateModified":"2019-05-17T20:57","image":{"@type":"ImageObject","url":"https://nomanabdullah.github.io/media/posts/6/final1.jpg","height":1500,"width":2100},"description":"Hello Visitors, Cross-Site Request Forgery (CSRF) is an attack that forces an end user to execute unwanted actions on a web application in which they’re currently authenticated. CSRF attacks specifically target state-changing requests, not theft of data since the attacker has no way to see&hellip;","author":{"@type":"Person","name":"Noman Abdullah"},"publisher":{"@type":"Organization","name":"Noman Abdullah","logo":{"@type":"ImageObject","url":"https://nomanabdullah.github.io/media/website/cooltext320795718719250.png","height":62,"width":194}}}</script><script async src="https://nomanabdullah.github.io/assets/js/lazysizes.min.js?v=dc4b666bb3324aea4ead22e26059c761"></script><style>.top__search [type=search] {
						background-image: url(https://nomanabdullah.github.io/assets/svg/search.svg);
				    }</style></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="https://nomanabdullah.github.io"><img src="https://nomanabdullah.github.io/media/website/cooltext320795718719250.png" alt="noman"></a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"></ul></nav><div class="top__search"><form action="https://nomanabdullah.github.io/search.html" class="search"><input type="search" name="q" placeholder="search..."></form></div></div></header><main><article class="post"><div class="hero"><div class="hero__wrap"><img src="https://nomanabdullah.github.io/media/posts/6/final1.jpg" sizes="(max-width: 1600px) 100vw, 1600px" srcset="https://nomanabdullah.github.io/media/posts/6/responsive/final1-xs.jpg 300w, https://nomanabdullah.github.io/media/posts/6/responsive/final1-sm.jpg 480w, https://nomanabdullah.github.io/media/posts/6/responsive/final1-md.jpg 768w, https://nomanabdullah.github.io/media/posts/6/responsive/final1-lg.jpg 1024w, https://nomanabdullah.github.io/media/posts/6/responsive/final1-xl.jpg 1360w, https://nomanabdullah.github.io/media/posts/6/responsive/final1-2xl.jpg 1600w" alt=""></div><header class="hero__text"><h1>CSRF - Synchronizer Token Pattern</h1><p class="post__meta"><time datetime="2019-05-17T13:54">May 17, 2019 </time>By <a href="https://nomanabdullah.github.io/authors/noman-abdullah/" rel="author" title="Noman Abdullah">Noman Abdullah</a></p></header></div><div class="post__entry"><p><strong>Hello Visitors,</strong></p><p>Cross-Site Request Forgery (<strong class="markup--strong markup--p-strong">CSRF</strong>) is an attack that forces an end user to execute unwanted actions on a web application in which they’re currently authenticated. <strong>CSRF </strong>attacks specifically target state-changing requests, not theft of data since the attacker has no way to see the response to the forged request. To prevent this attack, I am trying to implement one of the solutions called Synchronizer Token Pattern in this blog. A simple web application is created in this regard.</p><p><strong>Synchronizer Token Pattern (STP)</strong></p><p>This is a method where a secret, token and unique value for each request, is embedded by the web application in all HTML forms and verified on server side. This is one of the identified solutions to prevent Cross-site Request Forgery (<strong>CSRF</strong>) attack.</p><p><strong>How it works?</strong></p><p>In this method, a random string value is generated in server side and append it to the front end body and checks both values when a user submit web page. Normally this random string value is long enough and enocded in base64. </p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/001-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/001-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/001-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/001-md.png 768w" alt="" width="766" height="433"></p><p class="align-center"><strong>Synchronizer Tokens</strong></p><ul style="list-style-type: square;"><li class="align-left">Large Random value</li><li class="align-left">Unique value for per user session</li><li id="bca2" class="graf graf--li graf-after--li">Generated by a cryptographically secure random number generator</li><li class="align-left">Session contains token and checked in the backend</li><li class="align-left">If the token fails validation, the server rejects the requested action</li></ul><p><br><strong>A Simple Web Application</strong></p><p>Before getting started, my github repository should be cloned. The link can be found here, [<em><a href="https://github.com/NomanAbdullah/csrf-synchronizer-token-pattern" target="_blank" rel="nofollow noopener noreferrer">my github link</a></em>] </p><p>This web application is developed using PHP &amp; JS. An username and password is need to login to the application. For this application, the credentials are hardcoded (<strong>username: noman, password: noman</strong>)</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-285-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-285-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-285-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-285-md.png 768w" alt="" width="1360" height="660"></p><p class="graf graf--p graf-after--figure">The user credentials are submitted through this login form using a POST method. The valid user can successfully login else an error message will appear. At the time of logging in successfully, a unique session id and a token will be created along with the created session and generate a session id set as a cookie in the web browser.</p><p>This token is stored at the server side. For this project, the token is store in a text tile.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-295-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-295-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-295-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-295-md.png 768w" alt="" width="1338" height="671"></p><p>After logging in, the browser will send an Ajax call to  get the token to csrf_token_generator.php. This Ajax call contains the session id and following that the server will response the corresponding token along with the response body.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-288-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-288-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-288-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-288-md.png 768w" alt="" width="667" height="248"></p><p>The above screenshot shows the highlighted line where token embeds into a hidden field on form submit. Used openssl_randon_pseudo_bytes() function in PHP to generate the 32bit long <strong>CSRF</strong> token.The generated value then converted into it’s base64 value using base64_encode() in order to make it more secure. Although the whole thing is happening but the user doesn't see this when the page loads.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-286-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-286-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-286-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-286-md.png 768w" alt="" width="1341" height="669"></p><p>Here, a POST request is implemented to update user status. The post request contains this generated <strong>CSRF</strong> token and the session cookie.</p><p>When the user clicks “Update” button, the Post request is sent. Then the server validates session id which came from request header and <strong>CSRF</strong> token in the body.</p><p>If the token is valid, server accept the request and output comes out as following:</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-287-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-287-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-287-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-287-md.png 768w" alt="" width="435" height="180"></p><p>If the token is not valid, server rejects the request.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-289-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-289-xs.png 300w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-289-sm.png 480w ,https://nomanabdullah.github.io/media/posts/6/responsive/Screenshot-289-md.png 768w" alt="" width="606" height="166"></p><p><strong>Why this Method is safe?</strong></p><p>Assume, an attacker sends a link to a user that contains post request hidden to update user status but the attacker is not able to add the <strong>CSRF</strong> token to the POST request. In this case, server will ignore the request.</p><p>Thank you for reading my blog. Hope, this will help to implement Synchronizer Token Pattern in web applications.</p><p id="da5b"> </p><p class="post__last-updated">This article was updated on May 17, 2019</p></div><aside class="post__share"></aside><footer class="post__footer"><div class="post__bio"><img src="https://nomanabdullah.github.io/media/website/57133835_1508374879292805_8705344134uj224805888_n.jpg" alt="Noman Abdullah"><h3><a href="https://nomanabdullah.github.io/authors/noman-abdullah/" class="inverse" title="Noman Abdullah">Noman Abdullah</a></h3></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://nomanabdullah.github.io/squid-proxy-server-on-centos-7-with-web-caching/" class="inverse" rel="prev">Squid Proxy Server on CentOS 7 With Web Caching</a></h5></div><div class="post__nav__next">Next Post<h5><a href="https://nomanabdullah.github.io/csrf-double-submit-cookie-pattern/" class="inverse" rel="next">CSRF - Double Submit Cookie Pattern</a></h5></div></nav><div class="post__related"><h3>Related posts</h3><div class="post__related__wrap"><figure><a href="https://nomanabdullah.github.io/csrf-double-submit-cookie-pattern/"><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/final2-xs.jpg" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/final2-xs.jpg" data-expand="300" alt=""></a><figcaption><h4><a href="https://nomanabdullah.github.io/csrf-double-submit-cookie-pattern/" class="inverse">CSRF - Double Submit Cookie Pattern</a></h4><time datetime="2019-05-17T16:29">May 17, 2019</time></figcaption></figure></div></div></footer></article></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/nabdullah28" aria-label="Facebook"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/nabdulla28" aria-label="Twitter"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/nabdullah28" aria-label="Instagram"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/nabdullah28" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">Copyright 2019 @ Noman Abdullah</div></footer></div><script defer="defer" src="https://nomanabdullah.github.io/assets/js/jquery-3.2.1.slim.min.js?v=f307ecc7f6353949f03c06ffa70652a2"></script><script defer="defer" src="https://nomanabdullah.github.io/assets/js/scripts.min.js?v=f37607af05f83050cdcc37ea18bb5ee1"></script></body></html>