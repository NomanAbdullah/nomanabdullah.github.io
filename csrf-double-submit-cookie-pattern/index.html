<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CSRF - Double Submit Cookie Pattern - Noman Abdullah</title><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://nomanabdullah.github.io/csrf-double-submit-cookie-pattern/"><link rel="amphtml" href="https://nomanabdullah.github.io/amp/csrf-double-submit-cookie-pattern/"><link type="application/atom+xml" rel="alternate" href="https://nomanabdullah.github.io/feed.xml"><meta property="og:title" content="CSRF - Double Submit Cookie Pattern"><meta property="og:image" content="https://nomanabdullah.github.io/media/posts/7/final2.jpg"><meta property="og:site_name" content="Noman Abdullah | Blog"><meta property="og:description" content="Hello Visitors, In my previous post, Synchronizer Token Pattern has been explained with a sample web application which is one of the solutions to prevent Cross-Site Request Forgery attack. In this post, another solution called Double Submit Cookie Pattern (DSCP) is going to be explained with a sample&hellip;"><meta property="og:url" content="https://nomanabdullah.github.io/csrf-double-submit-cookie-pattern/"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,700%7CRoboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet"><link rel="stylesheet" href="https://nomanabdullah.github.io/assets/css/style.css?v=aa41620c4f80dc7a8874270e3bdddd5b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://nomanabdullah.github.io/csrf-double-submit-cookie-pattern/"},"headline":"CSRF - Double Submit Cookie Pattern","datePublished":"2019-05-17T16:29","dateModified":"2019-05-17T21:02","image":{"@type":"ImageObject","url":"https://nomanabdullah.github.io/media/posts/7/final2.jpg","height":1500,"width":2100},"description":"Hello Visitors, In my previous post, Synchronizer Token Pattern has been explained with a sample web application which is one of the solutions to prevent Cross-Site Request Forgery attack. In this post, another solution called Double Submit Cookie Pattern (DSCP) is going to be explained with a sample&hellip;","author":{"@type":"Person","name":"Noman Abdullah"},"publisher":{"@type":"Organization","name":"Noman Abdullah","logo":{"@type":"ImageObject","url":"https://nomanabdullah.github.io/media/website/cooltext320795718719250.png","height":62,"width":194}}}</script><script async src="https://nomanabdullah.github.io/assets/js/lazysizes.min.js?v=dc4b666bb3324aea4ead22e26059c761"></script><style>.top__search [type=search] {
						background-image: url(https://nomanabdullah.github.io/assets/svg/search.svg);
				    }</style></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="https://nomanabdullah.github.io"><img src="https://nomanabdullah.github.io/media/website/cooltext320795718719250.png" alt="noman"></a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"></ul></nav><div class="top__search"><form action="https://nomanabdullah.github.io/search.html" class="search"><input type="search" name="q" placeholder="search..."></form></div></div></header><main><article class="post"><div class="hero"><div class="hero__wrap"><img src="https://nomanabdullah.github.io/media/posts/7/final2.jpg" sizes="(max-width: 1600px) 100vw, 1600px" srcset="https://nomanabdullah.github.io/media/posts/7/responsive/final2-xs.jpg 300w, https://nomanabdullah.github.io/media/posts/7/responsive/final2-sm.jpg 480w, https://nomanabdullah.github.io/media/posts/7/responsive/final2-md.jpg 768w, https://nomanabdullah.github.io/media/posts/7/responsive/final2-lg.jpg 1024w, https://nomanabdullah.github.io/media/posts/7/responsive/final2-xl.jpg 1360w, https://nomanabdullah.github.io/media/posts/7/responsive/final2-2xl.jpg 1600w" alt=""></div><header class="hero__text"><h1>CSRF - Double Submit Cookie Pattern</h1><p class="post__meta"><time datetime="2019-05-17T16:29">May 17, 2019 </time>By <a href="https://nomanabdullah.github.io/authors/noman-abdullah/" rel="author" title="Noman Abdullah">Noman Abdullah</a></p></header></div><div class="post__entry"><p><strong>Hello Visitors,</strong></p><p>In my previous post, <em><a href="https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/" target="_blank" rel="nofollow noopener noreferrer">Synchronizer Token Pattern</a></em> has been explained with a sample web application which is one of the solutions to prevent Cross-Site Request Forgery attack.</p><p>In this post, another solution called Double Submit Cookie Pattern (DSCP) is going to be explained with a sample web application project.</p><p><strong>Double Submit Cookie Pattern (DSCP)</strong></p><p>This method can be defined as sending a random value in both a cookie and as a request parameter, with the server verifying if the cookie value and request value are equal.</p><p><strong>How it works?</strong></p><p class="graf graf--p graf-after--p">When a valid user logs in a site, the site generates a session identifier and set a cookie in the browser. Meanwhile, the site generates the cryptographically strong random value or the token for the session and set this as a cookie on the user's browser and that is distinguished from the session id. Since the server doesn't need to save the value in its end, the pattern is also called stateless <strong>CSRF</strong> defence.</p><p class="graf graf--p graf-after--p">Following that, the site requires every request to include this random value as a hidden value or another request parameter. For this reason, an attacker is not able to read any data transmitted from the server or modify the cookie values.</p><p class="graf graf--p graf-after--p">For this scenario, the mitigation method is to retrive the <strong>CSRF</strong> cookie from the response and add it into a special header to all the requests.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/002-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/002-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/002-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/002-md.png 768w" alt="" width="803" height="437"></p><p><strong>A simple web application</strong></p><p>Before getting started, my github repository have to be cloned. The link is given here, [<i><a href="https://github.com/NomanAbdullah/csrf-double-submit-cookie-pattern" target="_blank" rel="nofollow noopener noreferrer">my github link</a></i>] </p><p>This web application is developed using PHP &amp; JS. An username and password is need to login to the application. For this application, the credentials are hardcoded (<strong>username: noman, password: noman</strong>)</p><p id="199e"><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-299-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-299-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-299-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-299-md.png 768w" alt="" width="1360" height="667"></p><p class="graf graf--p graf-after--figure">User credentials in the login form is submitted using a POST methid. When the user is logged in successfully, server side will created a unique session id and a token but unlike STP, server only stores the session id in this method.</p><p>Following that server responses the corresponding token along with the response body. The generates session id and the server response token set cookies in the user's web browser.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-297-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-297-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-297-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-297-md.png 768w" alt="" width="1349" height="677"></p><p>After logging in, the user will be redirected to status update page. In this page, an AJAX call(self-call) is implemented to get the stored <strong>CSRF</strong> token from the browser cookies.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-293-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-293-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-293-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-293-md.png 768w" alt="" width="877" height="162"></p><p>Now, the corresponding <strong>CSRF</strong> token is added to the hidden field as following:</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-292-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-292-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-292-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-292-md.png 768w" alt="" width="665" height="248"></p><p class="graf graf--p graf-after--figure">A POST request is implemented to update user status. This request consists of the generated token and the session cookie.</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-291-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-291-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-291-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-291-md.png 768w" alt="" width="1342" height="675"></p><p>After adding some value when user clicks on "Update" button, the POST request is sent. Meanwhile, the cookie hearder is validated by the server for session id as well as server compares the token from request body which is a hidden value against the token from header cookie.</p><p>If both tokens are matched, the server accepts the request as follows:</p><p><img style="font-size: inherit;" src="https://nomanabdullah.github.io/media/posts/7/Screenshot-294.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-294-xs.png 300w, https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-294-sm.png 480w, https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-294-md.png 768w" alt="" width="1243" height="127"></p><p>Else the server will show following error:</p><p><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-298-xs.png" data-sizes="auto" data-srcset="https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-298-xs.png 300w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-298-sm.png 480w ,https://nomanabdullah.github.io/media/posts/7/responsive/Screenshot-298-md.png 768w" alt="" width="677" height="68"></p><p><strong>Why the method is safe?</strong></p><p>With every request cookies are sent autometically, regardless of whether the request was initiated by the original website or by a third party website. That’s why a cookie alone does not suffice as every request will contain it.</p><p id="e875" class="graf graf--p graf-after--p">But by having the token also in the request itself, an attacking site cannot generate valid requests any more as they can’t get hold on the user’s token.</p><p> Thank you for reading this post. Hope, this will help to implement Double Submit Cookie Pattern in web applications.</p><p class="post__last-updated">This article was updated on May 17, 2019</p></div><aside class="post__share"></aside><footer class="post__footer"><div class="post__bio"><img src="https://nomanabdullah.github.io/media/website/57133835_1508374879292805_8705344134uj224805888_n.jpg" alt="Noman Abdullah"><h3><a href="https://nomanabdullah.github.io/authors/noman-abdullah/" class="inverse" title="Noman Abdullah">Noman Abdullah</a></h3></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/" class="inverse" rel="prev">CSRF - Synchronizer Token Pattern</a></h5></div></nav><div class="post__related"><h3>Related posts</h3><div class="post__related__wrap"><figure><a href="https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/"><img class="lazyload" src="https://nomanabdullah.github.io/media/posts/6/responsive/final1-xs.jpg" data-srcset="https://nomanabdullah.github.io/media/posts/6/responsive/final1-xs.jpg" data-expand="300" alt=""></a><figcaption><h4><a href="https://nomanabdullah.github.io/csrf-synchnorizer-token-pattern/" class="inverse">CSRF - Synchronizer Token Pattern</a></h4><time datetime="2019-05-17T13:54">May 17, 2019</time></figcaption></figure></div></div></footer></article></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/nabdullah28" aria-label="Facebook"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/nabdulla28" aria-label="Twitter"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/nabdullah28" aria-label="Instagram"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/nabdullah28" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://nomanabdullah.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">Copyright 2019 @ Noman Abdullah</div></footer></div><script defer="defer" src="https://nomanabdullah.github.io/assets/js/jquery-3.2.1.slim.min.js?v=f307ecc7f6353949f03c06ffa70652a2"></script><script defer="defer" src="https://nomanabdullah.github.io/assets/js/scripts.min.js?v=f37607af05f83050cdcc37ea18bb5ee1"></script></body></html>